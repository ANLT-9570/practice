<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dg.main.dao.MenuMapper">

	<select id="findAllMenu" resultType="com.dg.main.Entity.Menu">
		select * from sys_menu
		where 1=1
		<if test="search != null ">
			<bind name="search" value="'%' + search + '%'"/>
			and name like #{search} or pcode like #{search}
		</if>
		ORDER BY id  LIMIT #{limit} OFFSET ${offset}
	</select>

	<select id="selectCount" resultType="int">
		SELECT count(*) FROM sys_menu
		<where>
			<if test="search != null " >
				<bind name="search" value="'%' + search + '%'"/>
				and name like #{search} or pcode like #{search}
			</if>
		</where>
	</select>

	<insert id="addMenu">
		insert into sys_menu(code,pcode,pcodes,name,icon,url,num,ismenu,tips)
		values(#{code},#{pcode},#{pcodes},#{name},#{icon},#{url},#{num},#{ismenu},#{tips});
	</insert>	
	
	<delete id="del">
		delete from sys_menu where id in
		<if test="mids.length != null">
			<foreach collection="mids" item="m" open="(" separator="," close=")">
				#{m}
			</foreach>
		</if>
	</delete>

	<select id="selectAllMain" resultType="com.dg.main.Entity.Tree">

		select id as id ,code as code,pcode as pid,name as name from sys_menu where id in (
		select menuid from sys_menu_role where roleid in(
		select roleid from sys_user_role
		<if test="uid != null">
			where userid = #{uid}
		</if>
		)) and ismenu = #{number} order by num asc
		<!-- select id as id ,code as code,pcode as pid,name as name from sys_menu where ismenu = #{number} order by num asc -->
	</select>

	<select id="selectBySysMenu" resultType="com.dg.main.Entity.Tree">
		select id as id ,code as code,pcode as pid,name as name from sys_menu where ismenu = #{number} order by num asc
	</select>

	<insert id="addMenuRole">
		insert into sys_menu_role(menuid,roleid) values
		<if test="mids.length > 0">
			<foreach collection="mids" item="mid"  separator="," >
				(#{mid},#{rid})
			</foreach>
		</if>

	</insert>

	<delete id="delByRid">
		delete from sys_menu_role where roleid = #{rid}
	</delete>

	<update id="updateMenu">
		update sys_menu
		set name=#{name},code=#{code},pcode=#{pcode},icon=#{icon},url=#{url},num=#{num},ismenu=#{ismenu}
		where id = #{id}
	</update>

	<delete id="delMenuRole">
		delete from sys_menu_role where menuid in
		<if test="mids.length != null">
			<foreach collection="mids" item="m" open="(" separator="," close=")">
				#{m}
			</foreach>
		</if>
	</delete>
	
</mapper>